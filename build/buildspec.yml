version: 0.2

phases:
  pre_build:
    commands:
      - 'Get-ChildItem Env: | Format-Table -Wrap -AutoSize'
      - 'cd $Env:CODEBUILD_SRC_DIR'
      - 'git branch --contains $Env:CODEBUILD_SOURCE_VERSION'
      - 'New-Item -ItemType Junction -Path $Env:TEMP\ChocoPackerBuild -Value $Env:CODEBUILD_SRC_DIR\build\ChocoPacker'
      - 'cd $Env:TEMP\ChocoPackerBuild'
      - 'nuget.exe restore'

  build:
    commands:
      - 'msbuild /p:OutputPath=$Env:TEMP\ChocoPacker'
      
  post_build:
    commands:
      - 'Start-Process -FilePath $Env:TEMP\ChocoPacker\ChocoPacker.exe'
