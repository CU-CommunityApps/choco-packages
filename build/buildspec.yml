version: 0.2

phases:
  install:
    commands:
      - 'Invoke-Expression -Command "$Env:CODEBUILD_SRC_DIR\build\ChocoPacker\build.ps1"'

  pre_build:
    commands:
      - 'Get-ChildItem Env:'
      #- '[Environment]::SetEnvironmentVariable("CODEBUILD_SOURCE_BRANCH", ((& "$Env:TEMP\ChocoPackerBuild\packages\Git-Windows-Minimal.2.18.0\tools\cmd\git.exe" branch -a $Env:CODEBUILD_SOURCE_VERSION) -Split "`r`n")[1], "Machine")'
      #- 'Write-Output [Environment]::GetEnvironmentVariable("CODEBUILD_SOURCE_BRANCH")'
      - Write-Output ((& "$Env:TEMP\ChocoPackerBuild\packages\Git-Windows-Minimal.2.18.0\tools\cmd\git.exe" branch -a $Env:CODEBUILD_SOURCE_VERSION) -Split "`r`n")[1]
      
  #build:
  #  commands:
      
  post_build:
    commands:
      - 'Write-Output $Env:CODEBUILD_SOURCE_BRANCH'
      - 'Start-Process -NoNewWindow -FilePath $Env:TEMP\ChocoPacker\ChocoPacker.exe'
