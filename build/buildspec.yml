version: 0.2

phases:
  install:
    commands:
      - 'Invoke-Expression -Command "$Env:CODEBUILD_SRC_DIR\build\ChocoPacker\build.ps1"'

  pre_build:
    commands:
      - '[Environment]::SetEnvironmentVariable("GIT", "$Env:TEMP\ChocoPackerBuild\packages\Git-Windows-Minimal.2.18.0\tools\cmd\git.exe", "Machine")'
      - '[Environment]::SetEnvironmentVariable("CODEBUILD_SOURCE_BRANCH", ((& "$Env:GIT" branch -a) -Split "`r`n")[1], "Machine")'
      - 'Get-ChildItem Env:'
      
  #build:
  #  commands:
      
  post_build:
    commands:
      - 'Write-Output $Env:CODEBUILD_SOURCE_BRANCH'
      - 'Start-Process -NoNewWindow -FilePath $Env:TEMP\ChocoPacker\ChocoPacker.exe'
